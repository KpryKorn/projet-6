<app-header />
<section class="container grow flex flex-col py-6 justify-center items-center gap-2">
  <h1 class="text-2xl font-medium mb-8">Mon profil</h1>

  <form
    [formGroup]="editProfileForm"
    (ngSubmit)="onSubmit()"
    class="flex flex-col gap-2 w-full sm:w-56"
  >
    <div class="flex flex-col gap-1">
      <input
        class="font-medium"
        pInputText
        type="username"
        id="username"
        formControlName="username"
        [invalid]="isInvalid('username')"
      />

      @if (isInvalid('username')) { @if (editProfileForm.get('username')?.hasError('required')) {
      <p class="text-sm text-red-500">Le nom d'utilisateur est requis</p>
      } @else if (editProfileForm.get('username')?.hasError('minlength')) {
      <p class="text-sm text-red-500">Le nom d'utilisateur doit faire au moins 3 caractères</p>
      } }
    </div>

    <div class="flex flex-col gap-1">
      <input
        class="font-medium"
        pInputText
        type="email"
        id="email"
        formControlName="email"
        [invalid]="isInvalid('email')"
      />

      @if (isInvalid('email')) { @if (editProfileForm.get('email')?.hasError('required')) {
      <p class="text-sm text-red-500">L'email est requis</p>
      } @else if (editProfileForm.get('email')?.hasError('email')) {
      <p class="text-sm text-red-500">Le format de l'email est invalide</p>
      } }
    </div>

    <div class="flex flex-col gap-1">
      <p-password
        class="*:placeholder:italic"
        formControlName="password"
        inputId="password"
        placeholder="Nouveau mot de passe (optionnel)"
        [invalid]="isInvalid('password')"
        autocomplete="off"
        fluid
        [toggleMask]="true"
      />

      @if (isInvalid('password')) {
      <p class="text-red-500 text-xs">
        Le mot de passe doit contenir au moins 8 caractères, une majuscule, une minuscule, un
        chiffre et un caractère spécial (@$!%*?&).
      </p>
      }
    </div>

    <button
      pButton
      type="submit"
      [disabled]="editProfileForm.invalid"
      class="mt-2 disabled:cursor-not-allowed"
    >
      <span pButtonLabel>Sauvegarder</span>
    </button>
  </form>

  <hr class="h-px w-full my-8 bg-black border-0" />

  <h2 class="text-2xl font-medium mb-8">Abonnements</h2>
  <div class="grid grid-cols-1 sm:grid-cols-2 auto-rows-fr gap-6 w-full">
    @for (sub of userSubscriptions(); track sub.id) {
    <app-subscription [subject]="sub" (onUnsubscribe)="handleOnUnsubscribe($event)" />
    }
  </div>
</section>
